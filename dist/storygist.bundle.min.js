!function(t){function e(e,i){var s=encodeURIComponent(window.location.href),a={beatSelector:"[data-sg]",contentParent:"main",initWidth:640,onboard:!0,finalBeat:{raw:null,html:'<div class="gist-beat-container">\x3c!--Entypo pictograms by Daniel Bruce — www.entypo.com--\x3e<div class="gist-beat-row"><h4>Share</h4><ul class="gist-share"><li><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u='+s+'"><svg version="1.1" x="0" y="0" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n<title>Facebook Logo</title>\n<desc>Share on Facebook</desc>\n<path d="M17 1H3C1.9 1 1 1.9 1 3v14c0 1.1 0.9 2 2 2h7v-7H8V9.53h2V7.48c0-2.16 1.21-3.68 3.77-3.68l1.8 0v2.61h-1.2C13.38 6.4 13 7.14 13 7.84v1.69h2.57L15 12h-2v7h4c1.1 0 2-0.9 2-2V3C19 1.9 18.1 1 17 1z"></path>\n</svg></a></li><li><a target="_blank" href="https://twitter.com/intent/tweet?url='+s+'"><svg version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n<title>Twitter Logo</title>\n <desc>Share on Twitter</desc>\n <path d="M17.316 6.246c0.008 0.2 0 0.3 0 0.488c0 4.99-3.797 10.742-10.74 10.742c-2.133 0-4.116-0.625-5.787-1.697 c0.296 0 0.6 0.1 0.9 0.053c1.77 0 3.397-0.604 4.688-1.615c-1.651-0.031-3.046-1.121-3.526-2.621 c0.23 0 0.5 0.1 0.7 0.066c0.345 0 0.679-0.045 0.995-0.131c-1.727-0.348-3.028-1.873-3.028-3.703c0-0.016 0-0.031 0-0.047 c0.509 0.3 1.1 0.5 1.7 0.473c-1.013-0.678-1.68-1.832-1.68-3.143c0-0.691 0.186-1.34 0.512-1.898 C3.942 5.5 6.7 7 9.9 7.158C9.798 6.9 9.8 6.6 9.8 6.297c0-2.084 1.689-3.773 3.774-3.773 c1.086 0 2.1 0.5 2.8 1.191c0.859-0.17 1.667-0.484 2.397-0.916c-0.282 0.881-0.881 1.621-1.66 2.1 c0.764-0.092 1.49-0.293 2.168-0.594C18.694 5.1 18.1 5.7 17.3 6.246z"></path>\n</svg></a></li><li><a target="_blank" href="mailto:?body='+s+'"><svg version="1.1" x="0" y="0" viewBox="0 0 20 20" xml:space="preserve">\n<title>Email Icon</title>\n<desc>Email page link</desc>\n<path d="M1.57 5.29c0.49 0.26 7.25 3.89 7.5 4.03C9.33 9.45 9.65 9.51 9.98 9.51c0.33 0 0.65-0.06 0.91-0.2s7.01-3.77 7.5-4.03C18.88 5.02 19.34 4 18.44 4H1.52C0.62 4 1.09 5.02 1.57 5.29zM18.61 7.49c-0.56 0.29-7.39 3.85-7.73 4.03s-0.58 0.2-0.91 0.2 -0.57-0.02-0.91-0.2S1.94 7.78 1.39 7.49C1 7.28 1 7.52 1 7.71S1 15 1 15c0 0.42 0.57 1 1 1h16c0.43 0 1-0.58 1-1 0 0 0-7.11 0-7.29S19 7.29 18.61 7.49z"></path>\n</svg></a></li></ul></div><div class="gist-beat-row"><h4 class="go-to-beginning">Go to the beginning</h4><ul></li><a class="go-to-beginning" href="#"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">\n<path d="M0.685,10h2.372V9.795c0.108-4.434,3.724-7.996,8.169-7.996c4.515,0,8.174,3.672,8.174,8.201s-3.659,8.199-8.174,8.199\n\tc-1.898,0-3.645-0.65-5.033-1.738l1.406-1.504c1.016,0.748,2.27,1.193,3.627,1.193c3.386,0,6.131-2.754,6.131-6.15\n\tc0-3.396-2.745-6.15-6.131-6.15c-3.317,0-6.018,2.643-6.125,5.945V10h2.672l-3.494,3.894L0.685,10z"/>\n</svg></li></ul></div></div>',type:"DIV"}};this.element=e,this.$els={},this.settings=t.extend({},a,i)}window.StoryGist=e}(jQuery),function(t,e){e.prototype.beatVideoPlay=function(t){t&&t.play()},e.prototype.beatVideoPause=function(t){t&&t.pause()},e.prototype.beatVideoPauseAll=function(e){var i=this;t("video").each(function(){var e=t(this).get(0);i.beatVideoPause(e)})},e.prototype.goToBeginning=function(){t(".gist-beat").css("display","flex")},e.prototype.globalActiveGist=function(e){t(".gist-beat").each(function(i){e.hasClass("gist-beat-"+i+"-active")&&e.removeClass("gist-beat-"+i+"-active"),t(this).hasClass("active")&&e.addClass("gist-beat-"+i+"-active"),e.hasClass("gist-beat-last-active")&&e.removeClass("gist-beat-last-active"),t(".gist-beat.last").hasClass("active")&&e.addClass("gist-beat-last-active")})},e.prototype.nextBeat=function(e,i){if(t(i).hasClass("last"));else{t(".gist-beat").removeClass("active");var s=t(i).next(".gist-beat");s.addClass("active");var a=["transition.slideLeftIn","transition.slideDownIn","transition.slideLeftBigIn","transition.shrinkIn","transition.flipXIn","transition.flipYIn","transition.fadeIn","transition.expandIn"];if(s.find("p").length){console.log("HAS A P TAG");var n=new SplitType(s.find("p"),{split:"lines, chars",position:"absolute"});console.log("split",n),s.find(".line").velocity("transition.shrinkIn",{duration:450,stagger:37.5})}s.find("figure img").velocity({blur:0},{duration:750,begin:function(e){s.find("figure figcaption").css("opacity",0),t(e).css("-webkit-filter","blur(81px)")},complete:function(t){s.find("figure figcaption").velocity("transition.slideLeftIn",{duration:1312.5})}}),s.find("figure.media").velocity({blur:0},{duration:750,begin:function(e){t(e).css("-webkit-filter","blur(81px)")}}),s.find(".pullquote").length&&(console.log("HAS A PULLQUOTE"),n=new SplitType(s.find(".pullquote"),{split:"lines"}),s.find(".line").velocity(function(){return a[Math.floor(Math.random()*a.length)]}(),{duration:750,stagger:375}));var o=s.find("video").get(0);this.beatVideoPlay(o)}+e==this.totalBeats-1?(t("#gist-progress").css("display","none"),t(i).css("display","none")):+e==+this.totalBeats||(t(i).css("display","none"),t("#gist-progress #gist-progress-beat-"+e).css("opacity",0))},e.prototype.prevBeat=function(e,i){if(t(i).is("#gist-beat-0"));else{t(".gist-beat").removeClass("active"),t(i).prev(".gist-beat").addClass("active");var s=t(i).prev(".gist-beat").find("video").get(0);this.beatVideoPlay(s)}+e===this.totalBeats&&t("#gist-progress").css("display","flex"),t("#gist-progress #gist-progress-beat-"+(e-1)).css("opacity",1),t("#gist-beat-"+(e-1)).css("display","flex")},e.prototype.viewInStory=function(){var e=t(".gist-beat:visible")[0],i=t(e).attr("data-origid");this.beatVideoPauseAll(),t("#gist-body").css("display","none"),t(this.element).toggleClass("gist-active"),t(this.settings.contentParent).css("display","block"),t(".site-header").css("display","block"),t(".progress").css("display","block");var s=t(this.settings.contentParent+" "+this.settings.beatSelector+":eq("+i+")");t("html, body").animate({scrollTop:s.offset().top-80},2e3)},e.prototype.swipeHandler=function(e){var i=t(e.target);if(i.hasClass("gist-beat")||(i=i.closest(".gist-beat"),i.hasClass("gist-beat"))){var s=i.attr("id").split("-")[2];switch(this.beatVideoPauseAll(),e.type){case"swipeup":this.viewInStory();break;case"swipeleft":this.nextBeat(s,i);break;case"swiperight":this.prevBeat(s,i);break;default:console.log(e.type)}}},e.prototype.scrollLock=function(t){t.preventDefault()}}(jQuery,StoryGist),function(t,e){e.prototype.init=function(){var e=this,i=t(e.element);if(t(window).width()<=e.settings.initWidth){var s=[],a=t(e.settings.contentParent),n=t(e.settings.beatSelector);if(i.prepend('<div id="gist-body"></div>'),!0===e.settings.onboard){var o=t('<div class="gist-onboard-container"><p>You\'re viewing the <strong>Gist</strong> of this story. The Gist gives you a visual summary of the story.</p><div class="gist-onboard-ui-container"><div class="gist-onboard-ui-left"><div class="gist-onboard-ui-text"> <p>← <strong>Tap</strong> to go <strong>backward</strong> in Gist</p></div></div><div class="gist-onboard-ui-right"><div class="gist-onboard-ui-text"><p><strong>Tap</strong> to go <br /> <strong>forward</strong> in Gist →</div></div></div><div class="gist-onboard-ui-text gist-onboard-ui-text-cta animated infinite bounce">Scroll to enter Gist <br />↓</p></div></div>');i.prepend(o)}var r=t("#gist-body");a.css("display","none"),i.addClass("gist-active"),n.each(function(t,e){var i={raw:e,html:e.outerHTML,type:e.nodeName,id:t};null!=e.previousElementSibling&&(i.prevtype=e.previousElementSibling.nodeName),"p"===i.type.toLowerCase()&&void 0!==i.prevtype?"h2"!==i.prevtype.toLowerCase()&&"figure"!==i.prevtype.toLowerCase()||s.push(i):s.push(i)}),s.push(e.settings.finalBeat),r.append('<button id="gist-view-story">View in full story ↓</button>'),t("#gist-view-story").click(function(){window.removeEventListener("touchmove",e.scrollLock),e.viewInStory()}),e.totalBeats=+(s.length-1),r.append('<div id="gist-progress"></div>'),s.forEach(function(i,s){!0===i.onBoard?r.append('<div id="gist-beat-'+s+'" class="gist-beat gist-beat-onboard" style="z-index:'+(e.totalBeats-s)+';">'+i.html+"</div>"):r.append('<div id="gist-beat-'+s+'" class="gist-beat" data-origid="'+i.id+'"  style="z-index:'+(e.totalBeats-s)+';">'+i.html+"</div>"),+s!=+e.totalBeats&&t("#gist-progress").append('<div id="gist-progress-beat-'+s+'" class="gist-progress-beat inactive" style="flex: 1;"></div>')}),"function"==typeof window.Hammer&&t(".gist-beat").each(function(t,i){console.log("Hammer init:",t),new Hammer(i).on("swipeleft swiperight swipeup",e.swipeHandler.bind(e))});var l=t("#gist-beat-0");t(".go-to-beginning").click(function(){t("#gist-progress").css("display","flex"),t(".gist-progress-beat").removeClass("inactive"),t(".gist-progress-beat").css("opacity",1),t(".gist-beat.last").removeClass("active"),l.addClass("active"),e.goToBeginning()}),l.addClass("active"),t(".gist-beat").click(function(s){var a=t(this).attr("id").split("-")[2],n=t(window).width(),o=t(this).position().left,r=s.pageX-o;e.beatVideoPauseAll(),r>n/2.5?e.nextBeat(a,this):e.prevBeat(a,this),e.globalActiveGist(i)}),t(".gist-beat:last-of-type").addClass("last"),e.globalActiveGist(i),t(".gist-beat").each(function(e){var i=t(this).find("video"),s=t(this).find(".video-js"),a=t(i).attr("id"),n=t(s).attr("id");void 0!==a&&t(i).attr("id",a+"-gist-beat"),void 0!==n&&t(s).attr("id",n+"-gist-beat")}),window.addEventListener("scroll",function t(){window.pageYOffset>=r.offset().top&&(o&&o.remove(),window.removeEventListener("scroll",t),window.addEventListener("touchmove",e.scrollLock))})}}}(jQuery,StoryGist),function(t){t.fn.storyGist=function(e){return this.each(function(){if(void 0===t(this).data("storyGist")){new StoryGist(this,e).init()}})}}(jQuery);